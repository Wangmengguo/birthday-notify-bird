# Birthday Notify Bird - Docker Compose with Nginx
# Usage: docker compose -f docker-compose.nginx.yml up -d
#
# This adds Nginx with IP whitelist protection
# Remember to edit nginx/nginx.conf to add your allowed IPs

services:
  app:
    build: .
    container_name: birthday-notify-bird-app
    restart: unless-stopped
    # Port not exposed directly - access through nginx
    expose:
      - "8888"
    volumes:
      - birthday_data:/app/data
    environment:
      - TO_EMAIL=${TO_EMAIL}
      - FROM_EMAIL=${FROM_EMAIL}
      - SMTP_HOST=${SMTP_HOST:-smtp.gmail.com}
      - SMTP_PORT=${SMTP_PORT:-587}
      - SMTP_USERNAME=${SMTP_USERNAME}
      - SMTP_PASSWORD=${SMTP_PASSWORD}
      - SMTP_MODE=${SMTP_MODE:-starttls}
      - TIMEZONE=${TIMEZONE:-Asia/Shanghai}
      - DAILY_RUN_AT=${DAILY_RUN_AT:-09:00}
      - BASE_URL=${BASE_URL:-}
      - ROOT_PATH=${ROOT_PATH:-}

  nginx:
    image: nginx:alpine
    container_name: birthday-notify-bird-nginx
    restart: unless-stopped
    ports:
      - "80:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - app

volumes:
  birthday_data:
    name: birthday_notify_bird_data

