{% extends "base.html" %}

{% block title %}å‘é€è®°å½• - Birthday Notify Bird{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <h1>ğŸ“¬ å‘é€è®°å½•</h1>
    <div style="display: flex; gap: 0.5rem;">
        <form action="{{ url_for_path('/api/trigger-check') }}" method="POST" style="display: inline;">
            <button type="submit" class="btn btn-secondary" onclick="return confirm('ç¡®å®šè¦ç«‹å³æ‰§è¡Œä¸€æ¬¡ç”Ÿæ—¥æ£€æŸ¥å—ï¼Ÿ')">
                ğŸ”„ æ‰‹åŠ¨è§¦å‘æ£€æŸ¥
            </button>
        </form>
        {% if logs %}
        <form action="{{ url_for_path('/logs/clear-all') }}" method="POST" style="display: inline;">
            <button type="submit" class="btn btn-danger" onclick="return confirm('ç¡®å®šè¦åˆ é™¤æ‰€æœ‰å‘é€è®°å½•å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼')">
                ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰è®°å½•
            </button>
        </form>
        {% endif %}
    </div>
</div>

{% if request.query_params.get('triggered') %}
<div class="flash flash-success" style="margin-bottom: 1rem;">
    âœ… ç”Ÿæ—¥æ£€æŸ¥å·²è§¦å‘ï¼Œè¯·æŸ¥çœ‹ä¸‹æ–¹è®°å½•
</div>
{% endif %}

{% if request.query_params.get('deleted') %}
<div class="flash flash-success" style="margin-bottom: 1rem;">
    âœ… è®°å½•å·²åˆ é™¤
</div>
{% endif %}

{% if request.query_params.get('cleared') %}
<div class="flash flash-success" style="margin-bottom: 1rem;">
    âœ… æ‰€æœ‰è®°å½•å·²æ¸…ç©º
</div>
{% endif %}

{% if logs %}
<div class="card" style="padding: 0; overflow: hidden;">
    <table>
        <thead>
            <tr>
                <th>æ—¶é—´</th>
                <th>è”ç³»äºº</th>
                <th>æé†’ç±»å‹</th>
                <th>çŠ¶æ€</th>
                <th>ä¸»é¢˜</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            {% for log in logs %}
            <tr>
                <td style="color: var(--text-secondary); font-size: 0.9rem;">
                    {{ log.created_at.strftime('%Y-%m-%d %H:%M') }}
                </td>
                <td style="font-weight: 500;">
                    {% if log.contact %}
                        {{ log.contact.name }}
                    {% else %}
                        <span style="color: var(--text-secondary);">(å·²åˆ é™¤)</span>
                    {% endif %}
                </td>
                <td>
                    {% if log.reminder_type == 'today' %}
                        <span class="badge badge-success">å½“å¤©</span>
                    {% elif log.reminder_type == 'day' %}
                        <span class="badge badge-warning">æå‰1å¤©</span>
                    {% elif log.reminder_type == 'week' %}
                        <span class="badge badge-info">æå‰7å¤©</span>
                    {% else %}
                        <span class="badge">{{ log.reminder_type }}</span>
                    {% endif %}
                </td>
                <td>
                    {% if log.status == 'sent' %}
                        <span style="color: var(--success);">âœ… æˆåŠŸ</span>
                    {% else %}
                        <span style="color: var(--danger);" title="{{ log.error or '' }}">âŒ å¤±è´¥</span>
                    {% endif %}
                </td>
                <td style="color: var(--text-secondary); max-width: 250px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                    {{ log.subject }}
                </td>
                <td>
                    <form action="{{ url_for_path('/logs/' ~ log.id ~ '/delete') }}" method="POST" style="display: inline;" 
                          onsubmit="return confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ');">
                        <button type="submit" class="btn btn-danger btn-sm">åˆ é™¤</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem;">
    <p style="color: var(--text-secondary); font-size: 0.9rem;">
        å…± {{ total_count }} æ¡è®°å½•
    </p>
    
    {% if total_pages > 1 %}
    <div style="display: flex; gap: 0.5rem;">
        {% if page > 1 %}
            <a href="{{ url_for_path('/logs') }}?page={{ page - 1 }}" class="btn btn-secondary btn-sm">ä¸Šä¸€é¡µ</a>
        {% endif %}
        <span style="padding: 0.375rem 0.75rem; color: var(--text-secondary);">
            {{ page }} / {{ total_pages }}
        </span>
        {% if page < total_pages %}
            <a href="{{ url_for_path('/logs') }}?page={{ page + 1 }}" class="btn btn-secondary btn-sm">ä¸‹ä¸€é¡µ</a>
        {% endif %}
    </div>
    {% endif %}
</div>

{% else %}
<div class="card empty-state">
    <div class="empty-state-icon">ğŸ“¬</div>
    <h3>æš‚æ— å‘é€è®°å½•</h3>
    <p>å½“æœ‰ç”Ÿæ—¥æé†’å‘é€æ—¶ï¼Œè®°å½•ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
    <form action="{{ url_for_path('/api/trigger-check') }}" method="POST" style="margin-top: 1rem;">
        <button type="submit" class="btn btn-primary">
            ğŸ”„ æ‰‹åŠ¨è§¦å‘æ£€æŸ¥
        </button>
    </form>
</div>
{% endif %}
{% endblock %}

